!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@pixi/core"),require("@pixi/display")):"function"==typeof define&&define.amd?define(["exports","@pixi/core","@pixi/display"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).PIXI=t.PIXI||{},t.PIXI.live2d=t.PIXI.live2d||{}),t.PIXI,t.PIXI)}(this,(function(t,e,r){"use strict";var o=Object.defineProperty,n=Math.pow,i=(t,e,r)=>(((t,e,r)=>{e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r),s=(t,e,r)=>new Promise(((o,n)=>{var i=t=>{try{a(r.next(t))}catch(e){n(e)}},s=t=>{try{a(r.throw(t))}catch(e){n(e)}},a=t=>t.done?o(t.value):Promise.resolve(t.value).then(i,s);a((r=r.apply(t,e)).next())}));var a,l;(l=a||(a={})).supportMoreMaskDivisions=!0,l.setOpacityFromMotion=!1;const u={LOG_LEVEL_VERBOSE:0,LOG_LEVEL_WARNING:1,LOG_LEVEL_ERROR:2,LOG_LEVEL_NONE:999,logLevel:1,sound:!0,fftSize:512,motionSync:!0,motionFadingDuration:500,idleMotionFadingDuration:2e3,expressionFadingDuration:500,preserveExpressionOnMotion:!0,cubism4:a},h={log(t,...e){u.logLevel<=u.LOG_LEVEL_VERBOSE&&console.log(`[${t}]`,...e)},warn(t,...e){u.logLevel<=u.LOG_LEVEL_WARNING&&console.warn(`[${t}]`,...e)},error(t,...e){u.logLevel<=u.LOG_LEVEL_ERROR&&console.error(`[${t}]`,...e)}};function c(t,e,r){return t<e?e:t>r?r:t}function p(t,e){return Math.random()*(e-t)+t}function d(t,e,r,o,n){const i=e[o];null!==i&&typeof i===t&&(r[n]=i)}function f(t,e,r,o,n){const i=e[o];Array.isArray(i)&&(r[n]=i.filter((e=>null!==e&&typeof e===t)))}function y(t){let e=t.lastIndexOf("/");return-1!=e&&(t=t.slice(0,e)),e=t.lastIndexOf("/"),-1!==e&&(t=t.slice(e+1)),t}function g(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}class m extends e.utils.EventEmitter{constructor(t,e){super(),i(this,"tag"),i(this,"settings"),i(this,"expressions",[]),i(this,"defaultExpression"),i(this,"currentExpression"),i(this,"reserveExpressionIndex",-1),i(this,"destroyed",!1),this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return s(this,null,(function*(){if(!this.definitions[t])return void h.warn(this.tag,`Undefined expression at [${t}]`);if(null===this.expressions[t])return void h.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e}))}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return s(this,null,(function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)null!==this.expressions[e]&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1}))}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return s(this,null,(function*(){if("number"!=typeof t&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length))return!1;if(t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!(!e||this.reserveExpressionIndex!==t)&&(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),!0)}))}update(t,e){return!this.isFinished()&&this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy");this.definitions=void 0,this.expressions=void 0}}const v=40/7.5,b=1/150;class x{constructor(){i(this,"targetX",0),i(this,"targetY",0),i(this,"x",0),i(this,"y",0),i(this,"vx",0),i(this,"vy",0)}focus(t,e,r=!1){this.targetX=c(t,-1,1),this.targetY=c(e,-1,1),r&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,r=this.targetY-this.y;if(Math.abs(e)<.01&&Math.abs(r)<.01)return;const o=Math.sqrt(n(e,2)+n(r,2)),i=v/(1e3/t);let s=i*(e/o)-this.vx,a=i*(r/o)-this.vy;const l=Math.sqrt(n(s,2)+n(a,2)),u=i*b*t;l>u&&(s*=u/l,a*=u/l),this.vx+=s,this.vy+=a;const h=Math.sqrt(n(this.vx,2)+n(this.vy,2)),c=.5*(Math.sqrt(n(u,2)+8*u*o)-u);h>c&&(this.vx*=c/h,this.vy*=c/h),this.x+=this.vx,this.y+=this.vy}}var M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})})),r}var E,P,A={},O={exports:{}};E=O,P=O.exports,function(t){var e=P&&!P.nodeType&&P,r=E&&!E.nodeType&&E,o="object"==typeof M&&M;o.global!==o&&o.window!==o&&o.self!==o||(t=o);var n,i,s=2147483647,a=36,l=1,u=26,h=38,c=700,p=72,d=128,f="-",y=/^xn--/,g=/[^\x20-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=a-l,x=Math.floor,w=String.fromCharCode;function A(t){throw new RangeError(v[t])}function O(t,e){for(var r=t.length,o=[];r--;)o[r]=e(t[r]);return o}function I(t,e){var r=t.split("@"),o="";return r.length>1&&(o=r[0]+"@",t=r[1]),o+O((t=t.replace(m,".")).split("."),e).join(".")}function S(t){for(var e,r,o=[],n=0,i=t.length;n<i;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<i?56320==(64512&(r=t.charCodeAt(n++)))?o.push(((1023&e)<<10)+(1023&r)+65536):(o.push(e),n--):o.push(e);return o}function j(t){return O(t,(function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=w(t)})).join("")}function _(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function F(t,e,r){var o=0;for(t=r?x(t/c):t>>1,t+=x(t/e);t>b*u>>1;o+=a)t=x(t/b);return x(o+(b+1)*t/(t+h))}function T(t){var e,r,o,n,i,h,c,y,g,m,v,b=[],M=t.length,w=0,E=d,P=p;for((r=t.lastIndexOf(f))<0&&(r=0),o=0;o<r;++o)t.charCodeAt(o)>=128&&A("not-basic"),b.push(t.charCodeAt(o));for(n=r>0?r+1:0;n<M;){for(i=w,h=1,c=a;n>=M&&A("invalid-input"),((y=(v=t.charCodeAt(n++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:a)>=a||y>x((s-w)/h))&&A("overflow"),w+=y*h,!(y<(g=c<=P?l:c>=P+u?u:c-P));c+=a)h>x(s/(m=a-g))&&A("overflow"),h*=m;P=F(w-i,e=b.length+1,0==i),x(w/e)>s-E&&A("overflow"),E+=x(w/e),w%=e,b.splice(w++,0,E)}return j(b)}function R(t){var e,r,o,n,i,h,c,y,g,m,v,b,M,E,P,O=[];for(b=(t=S(t)).length,e=d,r=0,i=p,h=0;h<b;++h)(v=t[h])<128&&O.push(w(v));for(o=n=O.length,n&&O.push(f);o<b;){for(c=s,h=0;h<b;++h)(v=t[h])>=e&&v<c&&(c=v);for(c-e>x((s-r)/(M=o+1))&&A("overflow"),r+=(c-e)*M,e=c,h=0;h<b;++h)if((v=t[h])<e&&++r>s&&A("overflow"),v==e){for(y=r,g=a;!(y<(m=g<=i?l:g>=i+u?u:g-i));g+=a)P=y-m,E=a-m,O.push(w(_(m+P%E,0))),y=x(P/E);O.push(w(_(y,0))),i=F(r,M,o==n),r=0,++o}++r,++e}return O.join("")}if(n={version:"1.4.1",ucs2:{decode:S,encode:j},decode:T,encode:R,toASCII:function(t){return I(t,(function(t){return g.test(t)?"xn--"+R(t):t}))},toUnicode:function(t){return I(t,(function(t){return y.test(t)?T(t.slice(4).toLowerCase()):t}))}},e&&r)if(E.exports==e)r.exports=n;else for(i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);else t.punycode=n}(M);var I,S=O.exports,j=Error,_=EvalError,F=RangeError,T=ReferenceError,R=SyntaxError,L=TypeError,D=URIError,k="undefined"!=typeof Symbol&&Symbol,C=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var o=Object.getOwnPropertySymbols(t);if(1!==o.length||o[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},N={__proto__:null,foo:{}},U=Object,G=Object.prototype.toString,H=Math.max,W=function(t,e){for(var r=[],o=0;o<t.length;o+=1)r[o]=t[o];for(var n=0;n<e.length;n+=1)r[n+t.length]=e[n];return r},q=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==G.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var r,o=function(t,e){for(var r=[],o=e||0,n=0;o<t.length;o+=1,n+=1)r[n]=t[o];return r}(arguments,1),n=H(0,e.length-o.length),i=[],s=0;s<n;s++)i[s]="$"+s;if(r=Function("binder","return function ("+function(t,e){for(var r="",o=0;o<t.length;o+=1)r+=t[o],o+1<t.length&&(r+=e);return r}(i,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof r){var n=e.apply(this,W(o,arguments));return Object(n)===n?n:this}return e.apply(t,W(o,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,r.prototype=new a,a.prototype=null}return r},B=Function.prototype.bind||q,$=Function.prototype.call,X=Object.prototype.hasOwnProperty,z=B.call($,X),V=j,Y=_,K=F,J=T,Q=R,Z=L,tt=D,et=Function,rt=function(t){try{return et('"use strict"; return ('+t+").constructor;")()}catch(e){}},ot=Object.getOwnPropertyDescriptor;if(ot)try{ot({},"")}catch(Qo){ot=null}var nt=function(){throw new Z},it=ot?function(){try{return nt}catch(t){try{return ot(arguments,"callee").get}catch(e){return nt}}}():nt,st="function"==typeof k&&"function"==typeof Symbol&&"symbol"==typeof k("foo")&&"symbol"==typeof Symbol("bar")&&C(),at={__proto__:N}.foo===N.foo&&!(N instanceof U),lt=Object.getPrototypeOf||(at?function(t){return t.__proto__}:null),ut={},ht="undefined"!=typeof Uint8Array&&lt?lt(Uint8Array):I,ct={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?I:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?I:ArrayBuffer,"%ArrayIteratorPrototype%":st&&lt?lt([][Symbol.iterator]()):I,"%AsyncFromSyncIteratorPrototype%":I,"%AsyncFunction%":ut,"%AsyncGenerator%":ut,"%AsyncGeneratorFunction%":ut,"%AsyncIteratorPrototype%":ut,"%Atomics%":"undefined"==typeof Atomics?I:Atomics,"%BigInt%":"undefined"==typeof BigInt?I:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?I:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?I:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?I:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":V,"%eval%":eval,"%EvalError%":Y,"%Float32Array%":"undefined"==typeof Float32Array?I:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?I:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?I:FinalizationRegistry,"%Function%":et,"%GeneratorFunction%":ut,"%Int8Array%":"undefined"==typeof Int8Array?I:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?I:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?I:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":st&&lt?lt(lt([][Symbol.iterator]())):I,"%JSON%":"object"==typeof JSON?JSON:I,"%Map%":"undefined"==typeof Map?I:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&st&&lt?lt((new Map)[Symbol.iterator]()):I,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?I:Promise,"%Proxy%":"undefined"==typeof Proxy?I:Proxy,"%RangeError%":K,"%ReferenceError%":J,"%Reflect%":"undefined"==typeof Reflect?I:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?I:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&st&&lt?lt((new Set)[Symbol.iterator]()):I,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?I:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":st&&lt?lt(""[Symbol.iterator]()):I,"%Symbol%":st?Symbol:I,"%SyntaxError%":Q,"%ThrowTypeError%":it,"%TypedArray%":ht,"%TypeError%":Z,"%Uint8Array%":"undefined"==typeof Uint8Array?I:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?I:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?I:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?I:Uint32Array,"%URIError%":tt,"%WeakMap%":"undefined"==typeof WeakMap?I:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?I:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?I:WeakSet};if(lt)try{null.error}catch(Qo){var pt=lt(lt(Qo));ct["%Error.prototype%"]=pt}var dt,ft,yt=function t(e){var r;if("%AsyncFunction%"===e)r=rt("async function () {}");else if("%GeneratorFunction%"===e)r=rt("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=rt("async function* () {}");else if("%AsyncGenerator%"===e){var o=t("%AsyncGeneratorFunction%");o&&(r=o.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&lt&&(r=lt(n.prototype))}return ct[e]=r,r},gt={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},mt=B,vt=z,bt=mt.call(Function.call,Array.prototype.concat),xt=mt.call(Function.apply,Array.prototype.splice),Mt=mt.call(Function.call,String.prototype.replace),wt=mt.call(Function.call,String.prototype.slice),Et=mt.call(Function.call,RegExp.prototype.exec),Pt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,At=/\\(\\)?/g,Ot=function(t,e){var r,o=t;if(vt(gt,o)&&(o="%"+(r=gt[o])[0]+"%"),vt(ct,o)){var n=ct[o];if(n===ut&&(n=yt(o)),void 0===n&&!e)throw new Z("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:o,value:n}}throw new Q("intrinsic "+t+" does not exist!")},It=function(t,e){if("string"!=typeof t||0===t.length)throw new Z("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new Z('"allowMissing" argument must be a boolean');if(null===Et(/^%?[^%]*%?$/,t))throw new Q("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=wt(t,0,1),r=wt(t,-1);if("%"===e&&"%"!==r)throw new Q("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new Q("invalid intrinsic syntax, expected opening `%`");var o=[];return Mt(t,Pt,(function(t,e,r,n){o[o.length]=r?Mt(n,At,"$1"):e||t})),o}(t),o=r.length>0?r[0]:"",n=Ot("%"+o+"%",e),i=n.name,s=n.value,a=!1,l=n.alias;l&&(o=l[0],xt(r,bt([0,1],l)));for(var u=1,h=!0;u<r.length;u+=1){var c=r[u],p=wt(c,0,1),d=wt(c,-1);if(('"'===p||"'"===p||"`"===p||'"'===d||"'"===d||"`"===d)&&p!==d)throw new Q("property names with quotes must have matching quotes");if("constructor"!==c&&h||(a=!0),vt(ct,i="%"+(o+="."+c)+"%"))s=ct[i];else if(null!=s){if(!(c in s)){if(!e)throw new Z("base intrinsic for "+t+" exists, but the property is not available.");return}if(ot&&u+1>=r.length){var f=ot(s,c);s=(h=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:s[c]}else h=vt(s,c),s=s[c];h&&!a&&(ct[i]=s)}}return s},St={exports:{}};function jt(){if(ft)return dt;ft=1;var t=It("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch(Qo){t=!1}return dt=t}var _t=It("%Object.getOwnPropertyDescriptor%",!0);if(_t)try{_t([],"length")}catch(Qo){_t=null}var Ft=_t,Tt=jt(),Rt=R,Lt=L,Dt=Ft,kt=jt(),Ct=function(){return!!kt};Ct.hasArrayLengthDefineBug=function(){if(!kt)return null;try{return 1!==kt([],"length",{value:1}).length}catch(Qo){return!0}};var Nt=It,Ut=function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new Lt("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new Lt("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Lt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Lt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Lt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Lt("`loose`, if provided, must be a boolean");var o=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,s=arguments.length>6&&arguments[6],a=!!Dt&&Dt(t,e);if(Tt)Tt(t,e,{configurable:null===i&&a?a.configurable:!i,enumerable:null===o&&a?a.enumerable:!o,value:r,writable:null===n&&a?a.writable:!n});else{if(!s&&(o||n||i))throw new Rt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=r}},Gt=Ct(),Ht=Ft,Wt=L,qt=Nt("%Math.floor%"),Bt=function(t,e){if("function"!=typeof t)throw new Wt("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||qt(e)!==e)throw new Wt("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],o=!0,n=!0;if("length"in t&&Ht){var i=Ht(t,"length");i&&!i.configurable&&(o=!1),i&&!i.writable&&(n=!1)}return(o||n||!r)&&(Gt?Ut(t,"length",e,!0,!0):Ut(t,"length",e)),t};!function(t){var e=B,r=It,o=Bt,n=L,i=r("%Function.prototype.apply%"),s=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||e.call(s,i),l=jt(),u=r("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new n("a function is required");var r=a(e,s,arguments);return o(r,1+u(0,t.length-(arguments.length-1)),!0)};var h=function(){return a(e,i,arguments)};l?l(t.exports,"apply",{value:h}):t.exports.apply=h}(St);var $t=It,Xt=St.exports,zt=Xt($t("String.prototype.indexOf"));const Vt=w(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Yt="function"==typeof Map&&Map.prototype,Kt=Object.getOwnPropertyDescriptor&&Yt?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Jt=Yt&&Kt&&"function"==typeof Kt.get?Kt.get:null,Qt=Yt&&Map.prototype.forEach,Zt="function"==typeof Set&&Set.prototype,te=Object.getOwnPropertyDescriptor&&Zt?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ee=Zt&&te&&"function"==typeof te.get?te.get:null,re=Zt&&Set.prototype.forEach,oe="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,ne="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,ie="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,se=Boolean.prototype.valueOf,ae=Object.prototype.toString,le=Function.prototype.toString,ue=String.prototype.match,he=String.prototype.slice,ce=String.prototype.replace,pe=String.prototype.toUpperCase,de=String.prototype.toLowerCase,fe=RegExp.prototype.test,ye=Array.prototype.concat,ge=Array.prototype.join,me=Array.prototype.slice,ve=Math.floor,be="function"==typeof BigInt?BigInt.prototype.valueOf:null,xe=Object.getOwnPropertySymbols,Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,we="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Ee="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===we||"symbol")?Symbol.toStringTag:null,Pe=Object.prototype.propertyIsEnumerable,Ae=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function Oe(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||fe.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var o=t<0?-ve(-t):ve(t);if(o!==t){var n=String(o),i=he.call(e,n.length+1);return ce.call(n,r,"$&_")+"."+ce.call(ce.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ce.call(e,r,"$&_")}var Ie=Vt,Se=Ie.custom,je=Le(Se)?Se:null;function _e(t,e,r){var o="double"===(r.quoteStyle||e)?'"':"'";return o+t+o}function Fe(t){return ce.call(String(t),/"/g,"&quot;")}function Te(t){return!("[object Array]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}function Re(t){return!("[object RegExp]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}function Le(t){if(we)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!Me)return!1;try{return Me.call(t),!0}catch(Qo){}return!1}var De=Object.prototype.hasOwnProperty||function(t){return t in this};function ke(t,e){return De.call(t,e)}function Ce(t){return ae.call(t)}function Ne(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,o=t.length;r<o;r++)if(t[r]===e)return r;return-1}function Ue(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,o="... "+r+" more character"+(r>1?"s":"");return Ue(he.call(t,0,e.maxStringLength),e)+o}return _e(ce.call(ce.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Ge),"single",e)}function Ge(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+pe.call(e.toString(16))}function He(t){return"Object("+t+")"}function We(t){return t+" { ? }"}function qe(t,e,r,o){return t+" ("+e+") {"+(o?Be(r,o):ge.call(r,", "))+"}"}function Be(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+ge.call(t,","+r)+"\n"+e.prev}function $e(t,e){var r=Te(t),o=[];if(r){o.length=t.length;for(var n=0;n<t.length;n++)o[n]=ke(t,n)?e(t[n],t):""}var i,s="function"==typeof xe?xe(t):[];if(we){i={};for(var a=0;a<s.length;a++)i["$"+s[a]]=s[a]}for(var l in t)ke(t,l)&&(r&&String(Number(l))===l&&l<t.length||we&&i["$"+l]instanceof Symbol||(fe.call(/[^\w$]/,l)?o.push(e(l,t)+": "+e(t[l],t)):o.push(l+": "+e(t[l],t))));if("function"==typeof xe)for(var u=0;u<s.length;u++)Pe.call(t,s[u])&&o.push("["+e(s[u])+"]: "+e(t[s[u]],t));return o}var Xe=It,ze=function(t,e){var r=$t(t,!!e);return"function"==typeof r&&zt(t,".prototype.")>-1?Xt(r):r},Ve=function t(e,r,o,n){var i=r||{};if(ke(i,"quoteStyle")&&"single"!==i.quoteStyle&&"double"!==i.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ke(i,"maxStringLength")&&("number"==typeof i.maxStringLength?i.maxStringLength<0&&i.maxStringLength!==1/0:null!==i.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=!ke(i,"customInspect")||i.customInspect;if("boolean"!=typeof s&&"symbol"!==s)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ke(i,"indent")&&null!==i.indent&&"\t"!==i.indent&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ke(i,"numericSeparator")&&"boolean"!=typeof i.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=i.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return Ue(e,i);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var l=String(e);return a?Oe(e,l):l}if("bigint"==typeof e){var u=String(e)+"n";return a?Oe(e,u):u}var h=void 0===i.depth?5:i.depth;if(void 0===o&&(o=0),o>=h&&h>0&&"object"==typeof e)return Te(e)?"[Array]":"[Object]";var c=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=ge.call(Array(t.indent+1)," ")}return{base:r,prev:ge.call(Array(e+1),r)}}(i,o);if(void 0===n)n=[];else if(Ne(n,e)>=0)return"[Circular]";function p(e,r,s){if(r&&(n=me.call(n)).push(r),s){var a={depth:i.depth};return ke(i,"quoteStyle")&&(a.quoteStyle=i.quoteStyle),t(e,a,o+1,n)}return t(e,i,o+1,n)}if("function"==typeof e&&!Re(e)){var d=function(t){if(t.name)return t.name;var e=ue.call(le.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),f=$e(e,p);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(f.length>0?" { "+ge.call(f,", ")+" }":"")}if(Le(e)){var y=we?ce.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Me.call(e);return"object"!=typeof e||we?y:He(y)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var g="<"+de.call(String(e.nodeName)),m=e.attributes||[],v=0;v<m.length;v++)g+=" "+m[v].name+"="+_e(Fe(m[v].value),"double",i);return g+=">",e.childNodes&&e.childNodes.length&&(g+="..."),g+="</"+de.call(String(e.nodeName))+">"}if(Te(e)){if(0===e.length)return"[]";var b=$e(e,p);return c&&!function(t){for(var e=0;e<t.length;e++)if(Ne(t[e],"\n")>=0)return!1;return!0}(b)?"["+Be(b,c)+"]":"[ "+ge.call(b,", ")+" ]"}if(function(t){return!("[object Error]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}(e)){var x=$e(e,p);return"cause"in Error.prototype||!("cause"in e)||Pe.call(e,"cause")?0===x.length?"["+String(e)+"]":"{ ["+String(e)+"] "+ge.call(x,", ")+" }":"{ ["+String(e)+"] "+ge.call(ye.call("[cause]: "+p(e.cause),x),", ")+" }"}if("object"==typeof e&&s){if(je&&"function"==typeof e[je]&&Ie)return Ie(e,{depth:h-o});if("symbol"!==s&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!Jt||!t||"object"!=typeof t)return!1;try{Jt.call(t);try{ee.call(t)}catch(g){return!0}return t instanceof Map}catch(Qo){}return!1}(e)){var w=[];return Qt&&Qt.call(e,(function(t,r){w.push(p(r,e,!0)+" => "+p(t,e))})),qe("Map",Jt.call(e),w,c)}if(function(t){if(!ee||!t||"object"!=typeof t)return!1;try{ee.call(t);try{Jt.call(t)}catch(e){return!0}return t instanceof Set}catch(Qo){}return!1}(e)){var E=[];return re&&re.call(e,(function(t){E.push(p(t,e))})),qe("Set",ee.call(e),E,c)}if(function(t){if(!oe||!t||"object"!=typeof t)return!1;try{oe.call(t,oe);try{ne.call(t,ne)}catch(g){return!0}return t instanceof WeakMap}catch(Qo){}return!1}(e))return We("WeakMap");if(function(t){if(!ne||!t||"object"!=typeof t)return!1;try{ne.call(t,ne);try{oe.call(t,oe)}catch(g){return!0}return t instanceof WeakSet}catch(Qo){}return!1}(e))return We("WeakSet");if(function(t){if(!ie||!t||"object"!=typeof t)return!1;try{return ie.call(t),!0}catch(Qo){}return!1}(e))return We("WeakRef");if(function(t){return!("[object Number]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}(e))return He(p(Number(e)));if(function(t){if(!t||"object"!=typeof t||!be)return!1;try{return be.call(t),!0}catch(Qo){}return!1}(e))return He(p(be.call(e)));if(function(t){return!("[object Boolean]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}(e))return He(se.call(e));if(function(t){return!("[object String]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}(e))return He(p(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if(e===M)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==Ce(t)||Ee&&"object"==typeof t&&Ee in t)}(e)&&!Re(e)){var P=$e(e,p),A=Ae?Ae(e)===Object.prototype:e instanceof Object||e.constructor===Object,O=e instanceof Object?"":"null prototype",I=!A&&Ee&&Object(e)===e&&Ee in e?he.call(Ce(e),8,-1):O?"Object":"",S=(A||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(I||O?"["+ge.call(ye.call([],I||[],O||[]),": ")+"] ":"");return 0===P.length?S+"{}":c?S+"{"+Be(P,c)+"}":S+"{ "+ge.call(P,", ")+" }"}return String(e)},Ye=L,Ke=Xe("%WeakMap%",!0),Je=Xe("%Map%",!0),Qe=ze("WeakMap.prototype.get",!0),Ze=ze("WeakMap.prototype.set",!0),tr=ze("WeakMap.prototype.has",!0),er=ze("Map.prototype.get",!0),rr=ze("Map.prototype.set",!0),or=ze("Map.prototype.has",!0),nr=function(t,e){for(var r,o=t;null!==(r=o.next);o=r)if(r.key===e)return o.next=r.next,r.next=t.next,t.next=r,r},ir=String.prototype.replace,sr=/%20/g,ar="RFC3986",lr={default:ar,formatters:{RFC1738:function(t){return ir.call(t,sr,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:ar},ur=lr,hr=Object.prototype.hasOwnProperty,cr=Array.isArray,pr=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),dr=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},o=0;o<t.length;++o)void 0!==t[o]&&(r[o]=t[o]);return r},fr=1024,yr={arrayToObject:dr,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],o=0;o<e.length;++o)for(var n=e[o],i=n.obj[n.prop],s=Object.keys(i),a=0;a<s.length;++a){var l=s[a],u=i[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:i,prop:l}),r.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(cr(r)){for(var o=[],n=0;n<r.length;++n)void 0!==r[n]&&o.push(r[n]);e.obj[e.prop]=o}}}(e),t},decode:function(t,e,r){var o=t.replace(/\+/g," ");if("iso-8859-1"===r)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(Qo){return o}},encode:function(t,e,r,o,n){if(0===t.length)return t;var i=t;if("symbol"==typeof t?i=Symbol.prototype.toString.call(t):"string"!=typeof t&&(i=String(t)),"iso-8859-1"===r)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var s="",a=0;a<i.length;a+=fr){for(var l=i.length>=fr?i.slice(a,a+fr):i,u=[],h=0;h<l.length;++h){var c=l.charCodeAt(h);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||n===ur.RFC1738&&(40===c||41===c)?u[u.length]=l.charAt(h):c<128?u[u.length]=pr[c]:c<2048?u[u.length]=pr[192|c>>6]+pr[128|63&c]:c<55296||c>=57344?u[u.length]=pr[224|c>>12]+pr[128|c>>6&63]+pr[128|63&c]:(h+=1,c=65536+((1023&c)<<10|1023&l.charCodeAt(h)),u[u.length]=pr[240|c>>18]+pr[128|c>>12&63]+pr[128|c>>6&63]+pr[128|63&c])}s+=u.join("")}return s},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(cr(t)){for(var r=[],o=0;o<t.length;o+=1)r.push(e(t[o]));return r}return e(t)},merge:function t(e,r,o){if(!r)return e;if("object"!=typeof r){if(cr(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(o&&(o.plainObjects||o.allowPrototypes)||!hr.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var n=e;return cr(e)&&!cr(r)&&(n=dr(e,o)),cr(e)&&cr(r)?(r.forEach((function(r,n){if(hr.call(e,n)){var i=e[n];i&&"object"==typeof i&&r&&"object"==typeof r?e[n]=t(i,r,o):e.push(r)}else e[n]=r})),e):Object.keys(r).reduce((function(e,n){var i=r[n];return hr.call(e,n)?e[n]=t(e[n],i,o):e[n]=i,e}),n)}},gr=function(){var t,e,r,o={assert:function(t){if(!o.has(t))throw new Ye("Side channel does not contain "+Ve(t))},get:function(o){if(Ke&&o&&("object"==typeof o||"function"==typeof o)){if(t)return Qe(t,o)}else if(Je){if(e)return er(e,o)}else if(r)return function(t,e){var r=nr(t,e);return r&&r.value}(r,o)},has:function(o){if(Ke&&o&&("object"==typeof o||"function"==typeof o)){if(t)return tr(t,o)}else if(Je){if(e)return or(e,o)}else if(r)return function(t,e){return!!nr(t,e)}(r,o);return!1},set:function(o,n){Ke&&o&&("object"==typeof o||"function"==typeof o)?(t||(t=new Ke),Ze(t,o,n)):Je?(e||(e=new Je),rr(e,o,n)):(r||(r={key:{},next:null}),function(t,e,r){var o=nr(t,e);o?o.value=r:t.next={key:e,next:t.next,value:r}}(r,o,n))}};return o},mr=yr,vr=lr,br=Object.prototype.hasOwnProperty,xr={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Mr=Array.isArray,wr=Array.prototype.push,Er=function(t,e){wr.apply(t,Mr(e)?e:[e])},Pr=Date.prototype.toISOString,Ar=vr.default,Or={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:mr.encode,encodeValuesOnly:!1,format:Ar,formatter:vr.formatters[Ar],indices:!1,serializeDate:function(t){return Pr.call(t)},skipNulls:!1,strictNullHandling:!1},Ir={},Sr=function t(e,r,o,n,i,s,a,l,u,h,c,p,d,f,y,g,m,v){for(var b,x=e,M=v,w=0,E=!1;void 0!==(M=M.get(Ir))&&!E;){var P=M.get(e);if(w+=1,void 0!==P){if(P===w)throw new RangeError("Cyclic object value");E=!0}void 0===M.get(Ir)&&(w=0)}if("function"==typeof h?x=h(r,x):x instanceof Date?x=d(x):"comma"===o&&Mr(x)&&(x=mr.maybeMap(x,(function(t){return t instanceof Date?d(t):t}))),null===x){if(s)return u&&!g?u(r,Or.encoder,m,"key",f):r;x=""}if("string"==typeof(b=x)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||mr.isBuffer(x))return u?[y(g?r:u(r,Or.encoder,m,"key",f))+"="+y(u(x,Or.encoder,m,"value",f))]:[y(r)+"="+y(String(x))];var A,O=[];if(void 0===x)return O;if("comma"===o&&Mr(x))g&&u&&(x=mr.maybeMap(x,u)),A=[{value:x.length>0?x.join(",")||null:void 0}];else if(Mr(h))A=h;else{var I=Object.keys(x);A=c?I.sort(c):I}var S=l?r.replace(/\./g,"%2E"):r,j=n&&Mr(x)&&1===x.length?S+"[]":S;if(i&&Mr(x)&&0===x.length)return j+"[]";for(var _=0;_<A.length;++_){var F=A[_],T="object"==typeof F&&void 0!==F.value?F.value:x[F];if(!a||null!==T){var R=p&&l?F.replace(/\./g,"%2E"):F,L=Mr(x)?"function"==typeof o?o(j,R):j:j+(p?"."+R:"["+R+"]");v.set(e,w);var D=gr();D.set(Ir,v),Er(O,t(T,L,o,n,i,s,a,l,"comma"===o&&g&&Mr(x)?null:u,h,c,p,d,f,y,g,m,D))}}return O},jr=yr,_r=Object.prototype.hasOwnProperty,Fr=Array.isArray,Tr={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:jr.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Rr=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},Lr=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},Dr=function(t,e,r,o){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(n),a=s?n.slice(0,s.index):n,l=[];if(a){if(!r.plainObjects&&_r.call(Object.prototype,a)&&!r.allowPrototypes)return;l.push(a)}for(var u=0;r.depth>0&&null!==(s=i.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&_r.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+n.slice(s.index)+"]"),function(t,e,r,o){for(var n=o?e:Lr(e,r),i=t.length-1;i>=0;--i){var s,a=t[i];if("[]"===a&&r.parseArrays)s=r.allowEmptyArrays&&""===n?[]:[].concat(n);else{s=r.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=r.decodeDotInKeys?l.replace(/%2E/g,"."):l,h=parseInt(u,10);r.parseArrays||""!==u?!isNaN(h)&&a!==u&&String(h)===u&&h>=0&&r.parseArrays&&h<=r.arrayLimit?(s=[])[h]=n:"__proto__"!==u&&(s[u]=n):s={0:n}}n=s}return n}(l,e,r,o)}},kr={formats:lr,parse:function(t,e){var r=function(t){if(!t)return Tr;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?Tr.charset:t.charset,r=void 0===t.duplicates?Tr.duplicates:t.duplicates;if("combine"!==r&&"first"!==r&&"last"!==r)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||Tr.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:Tr.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:Tr.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:Tr.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:Tr.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Tr.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:Tr.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:Tr.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:Tr.decoder,delimiter:"string"==typeof t.delimiter||jr.isRegExp(t.delimiter)?t.delimiter:Tr.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:Tr.depth,duplicates:r,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:Tr.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:Tr.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:Tr.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Tr.strictNullHandling}}(e);if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var o="string"==typeof t?function(t,e){var r,o={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,i=e.parameterLimit===1/0?void 0:e.parameterLimit,s=n.split(e.delimiter,i),a=-1,l=e.charset;if(e.charsetSentinel)for(r=0;r<s.length;++r)0===s[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===s[r]?l="utf-8":"utf8=%26%2310003%3B"===s[r]&&(l="iso-8859-1"),a=r,r=s.length);for(r=0;r<s.length;++r)if(r!==a){var u,h,c=s[r],p=c.indexOf("]="),d=-1===p?c.indexOf("="):p+1;-1===d?(u=e.decoder(c,Tr.decoder,l,"key"),h=e.strictNullHandling?null:""):(u=e.decoder(c.slice(0,d),Tr.decoder,l,"key"),h=jr.maybeMap(Lr(c.slice(d+1),e),(function(t){return e.decoder(t,Tr.decoder,l,"value")}))),h&&e.interpretNumericEntities&&"iso-8859-1"===l&&(h=Rr(h)),c.indexOf("[]=")>-1&&(h=Fr(h)?[h]:h);var f=_r.call(o,u);f&&"combine"===e.duplicates?o[u]=jr.combine(o[u],h):f&&"last"!==e.duplicates||(o[u]=h)}return o}(t,r):t,n=r.plainObjects?Object.create(null):{},i=Object.keys(o),s=0;s<i.length;++s){var a=i[s],l=Dr(a,o[a],r,"string"==typeof t);n=jr.merge(n,l,r)}return!0===r.allowSparse?n:jr.compact(n)},stringify:function(t,e){var r,o=t,n=function(t){if(!t)return Or;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||Or.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=vr.default;if(void 0!==t.format){if(!br.call(vr.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var o,n=vr.formatters[r],i=Or.filter;if(("function"==typeof t.filter||Mr(t.filter))&&(i=t.filter),o=t.arrayFormat in xr?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":Or.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var s=void 0===t.allowDots?!0===t.encodeDotInKeys||Or.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:Or.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:Or.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Or.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:void 0===t.delimiter?Or.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:Or.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:Or.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:Or.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:Or.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:Or.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:Or.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Or.strictNullHandling}}(e);"function"==typeof n.filter?o=(0,n.filter)("",o):Mr(n.filter)&&(r=n.filter);var i=[];if("object"!=typeof o||null===o)return"";var s=xr[n.arrayFormat],a="comma"===s&&n.commaRoundTrip;r||(r=Object.keys(o)),n.sort&&r.sort(n.sort);for(var l=gr(),u=0;u<r.length;++u){var h=r[u];n.skipNulls&&null===o[h]||Er(i,Sr(o[h],h,s,a,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}var c=i.join(n.delimiter),p=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),c.length>0?p+c:""}},Cr=S;function Nr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Ur=/^([a-z0-9.+-]+:)/i,Gr=/:[0-9]*$/,Hr=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,Wr=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),qr=["'"].concat(Wr),Br=["%","/","?",";","#"].concat(qr),$r=["/","?","#"],Xr=/^[+a-z0-9A-Z_-]{0,63}$/,zr=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Vr={javascript:!0,"javascript:":!0},Yr={javascript:!0,"javascript:":!0},Kr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Jr=kr;function Qr(t,e,r){if(t&&"object"==typeof t&&t instanceof Nr)return t;var o=new Nr;return o.parse(t,e,r),o}Nr.prototype.parse=function(t,e,r){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),n=-1!==o&&o<t.indexOf("#")?"?":"#",i=t.split(n);i[0]=i[0].replace(/\\/g,"/");var s=t=i.join(n);if(s=s.trim(),!r&&1===t.split("#").length){var a=Hr.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?Jr.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=Ur.exec(s);if(l){var u=(l=l[0]).toLowerCase();this.protocol=u,s=s.substr(l.length)}if(r||l||s.match(/^\/\/[^@/]+@[^@/]+/)){var h="//"===s.substr(0,2);!h||l&&Yr[l]||(s=s.substr(2),this.slashes=!0)}if(!Yr[l]&&(h||l&&!Kr[l])){for(var c,p,d=-1,f=0;f<$r.length;f++){-1!==(y=s.indexOf($r[f]))&&(-1===d||y<d)&&(d=y)}-1!==(p=-1===d?s.lastIndexOf("@"):s.lastIndexOf("@",d))&&(c=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(c)),d=-1;for(f=0;f<Br.length;f++){var y;-1!==(y=s.indexOf(Br[f]))&&(-1===d||y<d)&&(d=y)}-1===d&&(d=s.length),this.host=s.slice(0,d),s=s.slice(d),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),v=(f=0,m.length);f<v;f++){var b=m[f];if(b&&!b.match(Xr)){for(var x="",M=0,w=b.length;M<w;M++)b.charCodeAt(M)>127?x+="x":x+=b[M];if(!x.match(Xr)){var E=m.slice(0,f),P=m.slice(f+1),A=b.match(zr);A&&(E.push(A[1]),P.unshift(A[2])),P.length&&(s="/"+P.join(".")+s),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=Cr.toASCII(this.hostname));var O=this.port?":"+this.port:"",I=this.hostname||"";this.host=I+O,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!Vr[u])for(f=0,v=qr.length;f<v;f++){var S=qr[f];if(-1!==s.indexOf(S)){var j=encodeURIComponent(S);j===S&&(j=escape(S)),s=s.split(S).join(j)}}var _=s.indexOf("#");-1!==_&&(this.hash=s.substr(_),s=s.slice(0,_));var F=s.indexOf("?");if(-1!==F?(this.search=s.substr(F),this.query=s.substr(F+1),e&&(this.query=Jr.parse(this.query)),s=s.slice(0,F)):e&&(this.search="",this.query={}),s&&(this.pathname=s),Kr[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){O=this.pathname||"";var T=this.search||"";this.path=O+T}return this.href=this.format(),this},Nr.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",o=this.hash||"",n=!1,i="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(i=Jr.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var s=this.search||i&&"?"+i||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Kr[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),o&&"#"!==o.charAt(0)&&(o="#"+o),s&&"?"!==s.charAt(0)&&(s="?"+s),e+n+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+o},Nr.prototype.resolve=function(t){return this.resolveObject(Qr(t,!1,!0)).format()},Nr.prototype.resolveObject=function(t){if("string"==typeof t){var e=new Nr;e.parse(t,!1,!0),t=e}for(var r=new Nr,o=Object.keys(this),n=0;n<o.length;n++){var i=o[n];r[i]=this[i]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var l=s[a];"protocol"!==l&&(r[l]=t[l])}return Kr[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!Kr[t.protocol]){for(var u=Object.keys(t),h=0;h<u.length;h++){var c=u[h];r[c]=t[c]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||Yr[t.protocol])r.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var d=r.pathname||"",f=r.search||"";r.path=d+f}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),m=g||y||r.host&&t.pathname,v=m,b=r.pathname&&r.pathname.split("/")||[],x=(p=t.pathname&&t.pathname.split("/")||[],r.protocol&&!Kr[r.protocol]);if(x&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),m=m&&(""===p[0]||""===b[0])),g)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,b=p;else if(p.length)b||(b=[]),b.pop(),b=b.concat(p),r.search=t.search,r.query=t.query;else if(null!=t.search){if(x)r.host=b.shift(),r.hostname=r.host,(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.hostname=A.shift(),r.host=r.hostname);return r.search=t.search,r.query=t.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var M=b.slice(-1)[0],w=(r.host||t.host||b.length>1)&&("."===M||".."===M)||""===M,E=0,P=b.length;P>=0;P--)"."===(M=b[P])?b.splice(P,1):".."===M?(b.splice(P,1),E++):E&&(b.splice(P,1),E--);if(!m&&!v)for(;E--;E)b.unshift("..");!m||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),w&&"/"!==b.join("/").substr(-1)&&b.push("");var A,O=""===b[0]||b[0]&&"/"===b[0].charAt(0);x&&(r.hostname=O?"":b.length?b.shift():"",r.host=r.hostname,(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.hostname=A.shift(),r.host=r.hostname));return(m=m||r.host&&b.length)&&!O&&b.unshift(""),b.length>0?r.pathname=b.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},Nr.prototype.parseHost=function(){var t=this.host,e=Gr.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},A.parse=Qr,A.resolve=function(t,e){return Qr(t,!1,!0).resolve(e)},A.resolveObject=function(t,e){return t?Qr(t,!1,!0).resolveObject(e):e},A.format=function(t){return"string"==typeof t&&(t=Qr(t)),t instanceof Nr?t.format():Nr.prototype.format.call(t)},A.Url=Nr;class Zr{constructor(t){i(this,"json"),i(this,"name"),i(this,"url"),i(this,"pose"),i(this,"physics"),this.json=t;const e=t.url;if("string"!=typeof e)throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=y(this.url)}resolveURL(t){return A.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),void 0!==this.pose&&(this.pose=t(this.pose,"pose")),void 0!==this.physics&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles((e=>(t.push(e),e))),t}validateFiles(t){const e=(e,r)=>{const o=this.resolveURL(e);if(!t.includes(o)){if(r)throw new Error(`File "${e}" is defined in settings, but doesn't exist in given files`);return!1}return!0};[this.moc,...this.textures].forEach((t=>e(t,!0)));return this.getDefinedFiles().filter((t=>e(t,!1)))}}var to=(t=>(t[t.NONE=0]="NONE",t[t.IDLE=1]="IDLE",t[t.NORMAL=2]="NORMAL",t[t.FORCE=3]="FORCE",t))(to||{});class eo{constructor(){i(this,"tag"),i(this,"debug",!1),i(this,"currentPriority",0),i(this,"reservePriority",0),i(this,"currentGroup"),i(this,"currentIndex"),i(this,"reservedGroup"),i(this,"reservedIndex"),i(this,"reservedIdleGroup"),i(this,"reservedIdleIndex")}reserve(t,e,r){if(r<=0)return h.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return h.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return h.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(1===r){if(0!==this.currentPriority)return h.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(void 0!==this.reservedIdleGroup)return h.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(r<3){if(r<=this.currentPriority)return h.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(r<=this.reservePriority)return h.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,r)}return!0}start(t,e,r,o){if(1===o){if(this.setReservedIdle(void 0,void 0),0!==this.currentPriority)return h.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,r)),!1}else{if(e!==this.reservedGroup||r!==this.reservedIndex)return h.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,r)),!1;this.setReserved(void 0,void 0,0)}return!!t&&(this.setCurrent(e,r,o),!0)}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,r){this.currentPriority=r,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,r){this.reservePriority=r,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return void 0===this.currentGroup&&void 0===this.reservedIdleGroup}shouldOverrideExpression(){return!u.preserveExpressionOnMotion&&this.currentPriority>1}dump(t,e){if(this.debug){return`\n<Requested> group = "${t}", index = ${e}\n`+["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"].map((t=>"["+t+"] "+this[t])).join("\n")}return""}}const ro=.5;class oo{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach((t=>t.volume=this._volume))}static add(t,e,r,o){const n=new Audio(t);return n.volume=this._volume,n.preload="auto",n.crossOrigin=o,n.addEventListener("ended",(()=>{this.dispose(n),null==e||e()})),n.addEventListener("error",(e=>{this.dispose(n),h.warn("SoundManager",`Error occurred on "${t}"`,e.error),null==r||r(e.error)})),this.audios.push(n),n}static play(t){return new Promise(((e,r)=>{var o;null==(o=t.play())||o.catch((e=>{t.dispatchEvent(new ErrorEvent("error",{error:e})),r(e)})),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)}))}static addContext(t){const e=new AudioContext;return this.contexts.push(e),e}static addAnalyzer(t,e){const r=e.createMediaElementSource(t),o=e.createAnalyser();return o.fftSize=u.fftSize,o.minDecibels=-90,o.maxDecibels=-10,o.smoothingTimeConstant=.85,r.connect(o),o.connect(e.destination),this.analysers.push(o),o}static analyze(t){if(null!=t){const e=new Float32Array(t.fftSize);let r=0;t.getFloatTimeDomainData(e);for(const t of e)r+=t*t;return parseFloat(Math.sqrt(r/e.length*20).toFixed(1))}return parseFloat(Math.random().toFixed(1))}static dispose(t){t.pause(),t.removeAttribute("src"),g(this.audios,t)}static destroy(){for(let t=this.contexts.length-1;t>=0;t--)this.contexts[t].close();for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}i(oo,"audios",[]),i(oo,"analysers",[]),i(oo,"contexts",[]),i(oo,"_volume",ro);var no=(t=>(t.ALL="ALL",t.IDLE="IDLE",t.NONE="NONE",t))(no||{});class io extends e.utils.EventEmitter{constructor(t,e){super(),i(this,"tag"),i(this,"settings"),i(this,"motionGroups",{}),i(this,"state",new eo),i(this,"currentAudio"),i(this,"currentAnalyzer"),i(this,"currentContext"),i(this,"playing",!1),i(this,"destroyed",!1),this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){(null==t?void 0:t.idleMotionGroup)&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const r of Object.keys(this.definitions))this.motionGroups[r]=[];let e;switch(null==t?void 0:t.motionPreload){case"NONE":return;case"ALL":e=Object.keys(this.definitions);break;default:e=[this.groups.idle]}for(const r of e)if(this.definitions[r])for(let t=0;t<this.definitions[r].length;t++)this.loadMotion(r,t).then()}loadMotion(t,e){return s(this,null,(function*(){var r;if(!(null==(r=this.definitions[t])?void 0:r[e]))return void h.warn(this.tag,`Undefined motion at "${t}"[${e}]`);if(null===this.motionGroups[t][e])return void h.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);if(this.motionGroups[t][e])return this.motionGroups[t][e];const o=yield this._loadMotion(t,e);return this.destroyed?void 0:(this.motionGroups[t][e]=null!=o?o:null,o)}))}_loadMotion(t,e){throw new Error("Not implemented.")}speak(t){return s(this,arguments,(function*(t,{volume:e=.5,expression:r,resetExpression:o=!0,crossOrigin:n,onFinish:i,onError:s}={}){if(!u.sound)return!1;let a,l,c,p;if(this.currentAudio&&!this.currentAudio.ended)return!1;const d=t&&t.startsWith("data:");if(t&&!d){const e=document.createElement("a");e.href=t,p=t=e.href}else p="data:audio/";const f=t;if(f)try{a=oo.add(f,((t=this)=>{h.warn(this.tag,"Audio finished playing"),null==i||i(),o&&r&&t.expressionManager&&t.expressionManager.resetExpression(),t.currentAudio=void 0}),((t,e=this)=>{h.error(this.tag,"Error during audio playback:",t),null==s||s(t),o&&r&&e.expressionManager&&e.expressionManager.resetExpression(),e.currentAudio=void 0}),n),this.currentAudio=a,oo.volume=e,c=oo.addContext(this.currentAudio),this.currentContext=c,l=oo.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=l}catch(Qo){return h.warn(this.tag,"Failed to create audio",p,Qo),!1}if(a){let t=!0;const e=oo.play(a).catch((e=>{h.warn(this.tag,"Failed to play audio",a.src,e),t=!1}));if(u.motionSync&&(yield e,!t))return!1}return this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),r&&this.expressionManager&&this.expressionManager.setExpression(r),this.playing=!0,!0}))}startMotion(t,e){return s(this,arguments,(function*(t,e,r=to.NORMAL,{sound:o,volume:n=.5,expression:i,resetExpression:s=!0,crossOrigin:a,onFinish:l,onError:c}={}){var p;if(!this.state.reserve(t,e,r))return!1;if(this.currentAudio&&!this.currentAudio.ended&&r!=to.FORCE)return!1;const d=null==(p=this.definitions[t])?void 0:p[e];if(!d)return!1;let f,y,g,m;this.currentAudio&&oo.dispose(this.currentAudio);const v=o&&o.startsWith("data:");if(o&&!v){const t=document.createElement("a");t.href=o,m=o=t.href}else m=this.getSoundFile(d),m&&(m=this.settings.resolveURL(m));const b=m;if(b)try{f=oo.add(b,((t=this)=>{null==l||l(),s&&i&&t.expressionManager&&t.expressionManager.resetExpression(),t.currentAudio=void 0}),((t,e=this)=>{h.error(this.tag,"Error during audio playback:",t),null==c||c(t),s&&i&&e.expressionManager&&e.expressionManager.resetExpression(),e.currentAudio=void 0}),a),this.currentAudio=f,oo.volume=n,g=oo.addContext(this.currentAudio),this.currentContext=g,y=oo.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=y}catch(Qo){h.warn(this.tag,"Failed to create audio",m,Qo)}const x=yield this.loadMotion(t,e);if(f){const t=oo.play(f).catch((t=>h.warn(this.tag,"Failed to play audio",f.src,t)));u.motionSync&&(yield t)}return this.state.start(x,t,e,r)?(this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),h.log(this.tag,"Start motion:",this.getMotionName(d)),this.emit("motionStart",t,e,f),i&&this.expressionManager&&this.state.shouldOverrideExpression()&&this.expressionManager.setExpression(i),this.playing=!0,this._startMotion(x),!0):(f&&(oo.dispose(f),this.currentAudio=void 0),!1)}))}startRandomMotion(t,e){return s(this,arguments,(function*(t,e,{sound:r,volume:o=.5,expression:n,resetExpression:i=!0,crossOrigin:s,onFinish:a,onError:l}={}){const u=this.definitions[t];if(null==u?void 0:u.length){const h=[];for(let e=0;e<u.length;e++)null===this.motionGroups[t][e]||this.state.isActive(t,e)||h.push(e);if(h.length){const u=h[Math.floor(Math.random()*h.length)];return this.startMotion(t,u,e,{sound:r,volume:o,expression:n,resetExpression:i,crossOrigin:s,onFinish:a,onError:l})}}return!1}))}stopSpeaking(){this.currentAudio&&(oo.dispose(this.currentAudio),this.currentAudio=void 0)}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.stopSpeaking()}update(t,e){var r;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&(null==(r=this.expressionManager)||r.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,to.IDLE)),this.updateParameters(t,e)}mouthSync(){return this.currentAnalyzer?oo.analyze(this.currentAnalyzer):0}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),null==(t=this.expressionManager)||t.destroy();this.definitions=void 0,this.motionGroups=void 0}}const so={x:0,y:0,width:0,height:0};class ao extends e.utils.EventEmitter{constructor(){super(...arguments),i(this,"focusController",new x),i(this,"pose"),i(this,"physics"),i(this,"originalWidth",0),i(this,"originalHeight",0),i(this,"width",0),i(this,"height",0),i(this,"localTransform",new e.Matrix),i(this,"drawingMatrix",new e.Matrix),i(this,"hitAreas",{}),i(this,"textureFlipY",!1),i(this,"viewport",[0,0,0,0]),i(this,"destroyed",!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const r=Object.assign({width:2,height:2},this.getLayout());this.localTransform.scale(r.width/2,r.height/2),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const o=void 0!==r.x&&r.x-r.width/2||void 0!==r.centerX&&r.centerX||void 0!==r.left&&r.left-r.width/2||void 0!==r.right&&r.right+r.width/2||0,n=void 0!==r.y&&r.y-r.height/2||void 0!==r.centerY&&r.centerY||void 0!==r.top&&r.top-r.height/2||void 0!==r.bottom&&r.bottom+r.height/2||0;this.localTransform.translate(this.width*o,-this.height*n)}setupHitAreas(){const t=this.getHitAreaDefs().filter((t=>t.index>=0));for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter((r=>this.isHit(r,t,e)))}isHit(t,e,r){if(!this.hitAreas[t])return!1;const o=this.hitAreas[t].index,n=this.getDrawableBounds(o,so);return n.x<=e&&e<=n.x+n.width&&n.y<=r&&r<=n.y+n.height}getDrawableBounds(t,e){const r=this.getDrawableVertices(t);let o=r[0],n=r[0],i=r[1],s=r[1];for(let a=0;a<r.length;a+=2){const t=r[a],e=r[a+1];o=Math.min(t,o),n=Math.max(t,n),i=Math.min(e,i),s=Math.max(e,s)}return null!=e||(e={}),e.x=o,e.y=i,e.width=n-o,e.height=s-i,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0,this.parallelMotionManager.forEach((t=>t.destroy())),this.parallelMotionManager=[]}}class lo extends Error{constructor(t,e,r,o=!1){super(t),this.url=e,this.status=r,this.aborted=o}}const uo=class t{static createXHR(e,r,o,n,i){const s=new XMLHttpRequest;if(t.allXhrSet.add(s),e){let r=t.xhrMap.get(e);r?r.add(s):(r=new Set([s]),t.xhrMap.set(e,r)),e.listeners("destroy").includes(t.cancelXHRs)||e.once("destroy",t.cancelXHRs)}return s.open("GET",r),s.responseType=o,s.onload=()=>{200!==s.status&&0!==s.status||!s.response?s.onerror():n(s.response)},s.onerror=()=>{h.warn("XHRLoader",`Failed to load resource as ${s.responseType} (Status ${s.status}): ${r}`),i(new lo("Network error.",r,s.status))},s.onabort=()=>i(new lo("Aborted.",r,s.status,!0)),s.onloadend=()=>{var r;t.allXhrSet.delete(s),e&&(null==(r=t.xhrMap.get(e))||r.delete(s))},s}static cancelXHRs(){var e;null==(e=t.xhrMap.get(this))||e.forEach((e=>{e.abort(),t.allXhrSet.delete(e)})),t.xhrMap.delete(this)}static release(){t.allXhrSet.forEach((t=>t.abort())),t.allXhrSet.clear(),t.xhrMap=new WeakMap}};i(uo,"xhrMap",new WeakMap),i(uo,"allXhrSet",new Set),i(uo,"loader",((t,e)=>new Promise(((e,r)=>{uo.createXHR(t.target,t.settings?t.settings.resolveURL(t.url):t.url,t.type,(r=>{t.result=r,e()}),r).send()}))));let ho=uo;function co(t,e){let r=-1;return function o(n,i){if(i)return Promise.reject(i);if(n<=r)return Promise.reject(new Error("next() called multiple times"));r=n;const s=t[n];if(!s)return Promise.resolve();try{return Promise.resolve(s(e,o.bind(null,n+1)))}catch(a){return Promise.reject(a)}}(0)}class po{static load(t){return co(this.middlewares,t).then((()=>t.result))}}function fo(){}i(po,"middlewares",[ho.loader]);const yo="Live2DFactory",go=(t,e)=>s(this,null,(function*(){if("string"==typeof t.source){const e=yield po.load({url:t.source,type:"json",target:t.live2dModel});e.url=t.source,t.source=e,t.live2dModel.emit("settingsJSONLoaded",e)}return e()})),mo=(t,e)=>s(this,null,(function*(){if(t.source instanceof Zr)return t.settings=t.source,e();if("object"==typeof t.source){const r=Io.findRuntime(t.source);if(r){const o=r.createModelSettings(t.source);return t.settings=o,t.live2dModel.emit("settingsLoaded",o),e()}}throw new TypeError("Unknown settings format.")})),vo=(t,e)=>{if(t.settings){const r=Io.findRuntime(t.settings);if(r)return r.ready().then(e)}return e()},bo=(t,e)=>s(this,null,(function*(){yield e();const r=t.internalModel;if(r){const e=t.settings,o=Io.findRuntime(e);if(o){const n=[];e.pose&&n.push(po.load({settings:e,url:e.pose,type:"json",target:r}).then((e=>{r.pose=o.createPose(r.coreModel,e),t.live2dModel.emit("poseLoaded",r.pose)})).catch((e=>{t.live2dModel.emit("poseLoadError",e),h.warn(yo,"Failed to load pose.",e)}))),e.physics&&n.push(po.load({settings:e,url:e.physics,type:"json",target:r}).then((e=>{r.physics=o.createPhysics(r.coreModel,e),t.live2dModel.emit("physicsLoaded",r.physics)})).catch((e=>{t.live2dModel.emit("physicsLoadError",e),h.warn(yo,"Failed to load physics.",e)}))),n.length&&(yield Promise.all(n))}}})),xo=(t,r)=>s(this,null,(function*(){if(!t.settings)throw new TypeError("Missing settings.");{const o=t.live2dModel,n=Promise.all(t.settings.textures.map((r=>function(t,r={}){const o={resourceOptions:{crossorigin:r.crossOrigin}};if(e.Texture.fromURL)return e.Texture.fromURL(t,o).catch((t=>{if(t instanceof Error)throw t;const e=new Error("Texture loading error");throw e.event=t,e}));o.resourceOptions.autoLoad=!1;const n=e.Texture.from(t,o);if(n.baseTexture.valid)return Promise.resolve(n);const i=n.baseTexture.resource;return null!=i._live2d_load||(i._live2d_load=new Promise(((t,e)=>{const r=t=>{i.source.removeEventListener("error",r);const o=new Error("Texture loading error");o.event=t,e(o)};i.source.addEventListener("error",r),i.load().then((()=>t(n))).catch(r)}))),i._live2d_load}(t.settings.resolveURL(r),{crossOrigin:t.options.crossOrigin}))));if(n.catch(fo),yield r(),!t.internalModel)throw new TypeError("Missing internal model.");o.internalModel=t.internalModel,o.emit("modelLoaded",t.internalModel),o.textures=yield n,o.emit("textureLoaded",o.textures)}})),Mo=(t,e)=>s(this,null,(function*(){const r=t.settings;if(r instanceof Zr){const o=Io.findRuntime(r);if(!o)throw new TypeError("Unknown model settings.");const n=yield po.load({settings:r,url:r.moc,type:"arraybuffer",target:t.live2dModel});if(!o.isValidMoc(n))throw new Error("Invalid moc data");const i=o.createCoreModel(n);return t.internalModel=o.createInternalModel(i,r,t.options),e()}throw new TypeError("Missing settings.")})),wo=class t{static unzip(e,r){return s(this,null,(function*(){const o=yield t.getFilePaths(e),n=[];for(const t of r.getDefinedFiles()){const e=decodeURI(A.resolve(r.url,t));o.includes(e)&&n.push(e)}const i=yield t.getFiles(e,n);for(let t=0;t<i.length;t++){const e=n[t],r=i[t];Object.defineProperty(r,"webkitRelativePath",{value:e})}return i}))}static createSettings(e){return s(this,null,(function*(){const r=(yield t.getFilePaths(e)).find((t=>t.endsWith("model.json")||t.endsWith("model3.json")));if(!r)throw new Error("Settings file not found");const o=yield t.readText(e,r);if(!o)throw new Error("Empty settings file: "+r);const n=JSON.parse(o);n.url=r;const i=t.live2dFactory.findRuntime(n);if(!i)throw new Error("Unknown settings JSON");return i.createModelSettings(n)}))}static zipReader(t,e){return s(this,null,(function*(){throw new Error("Not implemented")}))}static getFilePaths(t){return s(this,null,(function*(){throw new Error("Not implemented")}))}static getFiles(t,e){return s(this,null,(function*(){throw new Error("Not implemented")}))}static readText(t,e){return s(this,null,(function*(){throw new Error("Not implemented")}))}static releaseReader(t){}};i(wo,"live2dFactory"),i(wo,"ZIP_PROTOCOL","zip://"),i(wo,"uid",0),i(wo,"factory",((t,e)=>s(wo,null,(function*(){const r=t.source;let o,n,i;if("string"==typeof r&&(r.endsWith(".zip")||r.startsWith(wo.ZIP_PROTOCOL))?(o=r.startsWith(wo.ZIP_PROTOCOL)?r.slice(wo.ZIP_PROTOCOL.length):r,n=yield po.load({url:o,type:"blob",target:t.live2dModel})):Array.isArray(r)&&1===r.length&&r[0]instanceof File&&r[0].name.endsWith(".zip")&&(n=r[0],o=URL.createObjectURL(n),i=r.settings),n){if(!n.size)throw new Error("Empty zip file");const e=yield wo.zipReader(n,o);i||(i=yield wo.createSettings(e)),i._objectURL=wo.ZIP_PROTOCOL+wo.uid+"/"+i.url;const r=yield wo.unzip(e,i);r.settings=i,t.source=r,o.startsWith("blob:")&&t.live2dModel.once("modelLoaded",(t=>{t.once("destroy",(function(){URL.revokeObjectURL(o)}))})),wo.releaseReader(e)}return e()}))));let Eo=wo;const Po=class t{static resolveURL(e,r){var o;const n=null==(o=t.filesMap[e])?void 0:o[r];if(void 0===n)throw new Error("Cannot find this file from uploaded files: "+r);return n}static upload(e,r){return s(this,null,(function*(){const o={};for(const t of r.getDefinedFiles()){const n=decodeURI(A.resolve(r.url,t)),i=e.find((t=>t.webkitRelativePath===n));i&&(o[t]=URL.createObjectURL(i))}t.filesMap[r._objectURL]=o}))}static createSettings(e){return s(this,null,(function*(){const r=e.find((t=>t.name.endsWith("model.json")||t.name.endsWith("model3.json")));if(!r)throw new TypeError("Settings file not found");const o=yield t.readText(r),n=JSON.parse(o);n.url=r.webkitRelativePath;const i=Io.findRuntime(n);if(!i)throw new Error("Unknown settings JSON");const s=i.createModelSettings(n);return s._objectURL=URL.createObjectURL(r),s}))}static readText(t){return s(this,null,(function*(){return new Promise(((e,r)=>{const o=new FileReader;o.onload=()=>e(o.result),o.onerror=r,o.readAsText(t,"utf8")}))}))}};i(Po,"live2dFactory"),i(Po,"filesMap",{}),i(Po,"factory",((t,e)=>s(Po,null,(function*(){if(Array.isArray(t.source)&&t.source[0]instanceof File){const e=t.source;let r=e.settings;if(r){if(!r._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings')}else r=yield Po.createSettings(e);r.validateFiles(e.map((t=>encodeURI(t.webkitRelativePath)))),yield Po.upload(e,r),r.resolveURL=function(t){return Po.resolveURL(this._objectURL,t)},t.source=r,t.live2dModel.once("modelLoaded",(t=>{t.once("destroy",(function(){const t=this.settings._objectURL;if(URL.revokeObjectURL(t),Po.filesMap[t])for(const e of Object.values(Po.filesMap[t]))URL.revokeObjectURL(e);delete Po.filesMap[t]}))}))}return e()}))));let Ao=Po;const Oo=class t{static registerRuntime(e){t.runtimes.push(e),t.runtimes.sort(((t,e)=>e.version-t.version))}static findRuntime(e){for(const r of t.runtimes)if(r.test(e))return r}static setupLive2DModel(e,r,o){return s(this,null,(function*(){const n=new Promise((t=>e.once("textureLoaded",t))),i=new Promise((t=>e.once("modelLoaded",t))),s=Promise.all([n,i]).then((()=>e.emit("ready")));yield co(t.live2DModelMiddlewares,{live2dModel:e,source:r,options:o||{}}),yield s,e.emit("load")}))}static loadMotion(e,r,o){var n;const i=t=>e.emit("motionLoadError",r,o,t);try{const s=null==(n=e.definitions[r])?void 0:n[o];if(!s)return Promise.resolve(void 0);e.listeners("destroy").includes(t.releaseTasks)||e.once("destroy",t.releaseTasks);let a=t.motionTasksMap.get(e);a||(a={},t.motionTasksMap.set(e,a));let l=a[r];l||(l=[],a[r]=l);const u=e.getMotionFile(s);return null!=l[o]||(l[o]=po.load({url:u,settings:e.settings,type:e.motionDataType,target:e}).then((n=>{var i;const a=null==(i=t.motionTasksMap.get(e))?void 0:i[r];a&&delete a[o];const l=e.createMotion(n,r,s);return e.emit("motionLoaded",r,o,l),l})).catch((t=>{h.warn(e.tag,`Failed to load motion: ${u}\n`,t),i(t)}))),l[o]}catch(Qo){h.warn(e.tag,`Failed to load motion at "${r}"[${o}]\n`,Qo),i(Qo)}return Promise.resolve(void 0)}static loadExpression(e,r){const o=t=>e.emit("expressionLoadError",r,t);try{const n=e.definitions[r];if(!n)return Promise.resolve(void 0);e.listeners("destroy").includes(t.releaseTasks)||e.once("destroy",t.releaseTasks);let i=t.expressionTasksMap.get(e);i||(i=[],t.expressionTasksMap.set(e,i));const s=e.getExpressionFile(n);return null!=i[r]||(i[r]=po.load({url:s,settings:e.settings,type:"json",target:e}).then((o=>{const i=t.expressionTasksMap.get(e);i&&delete i[r];const s=e.createExpression(o,n);return e.emit("expressionLoaded",r,s),s})).catch((t=>{h.warn(e.tag,`Failed to load expression: ${s}\n`,t),o(t)}))),i[r]}catch(Qo){h.warn(e.tag,`Failed to load expression at [${r}]\n`,Qo),o(Qo)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof io?t.motionTasksMap.delete(this):t.expressionTasksMap.delete(this)}};i(Oo,"runtimes",[]),i(Oo,"urlToJSON",go),i(Oo,"jsonToSettings",mo),i(Oo,"waitUntilReady",vo),i(Oo,"setupOptionals",bo),i(Oo,"setupEssentials",xo),i(Oo,"createInternalModel",Mo),i(Oo,"live2DModelMiddlewares",[Eo.factory,Ao.factory,go,mo,vo,bo,xo,Mo]),i(Oo,"motionTasksMap",new WeakMap),i(Oo,"expressionTasksMap",new WeakMap);let Io=Oo;io.prototype._loadMotion=function(t,e){return Io.loadMotion(this,t,e)},m.prototype._loadExpression=function(t){return Io.loadExpression(this,t)},Ao.live2dFactory=Io,Eo.live2dFactory=Io;const So=class t{constructor(e,{autoUpdate:r=!0,autoHitTest:o=!0,autoFocus:n=!0,autoInteract:s,ticker:a}={}){i(this,"model"),i(this,"destroyed",!1),i(this,"_ticker"),i(this,"_autoUpdate",!1),i(this,"_autoHitTest",!1),i(this,"_autoFocus",!1),a||(t.defaultTicker?a=t.defaultTicker:"undefined"!=typeof PIXI&&(a=PIXI.Ticker.shared)),void 0!==s&&(o=s,n=s,h.warn(e.tag,"options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.")),this.model=e,this.ticker=a,this.autoUpdate=r,this.autoHitTest=o,this.autoFocus=n,(o||n)&&(this.model.eventMode="static")}get ticker(){return this._ticker}set ticker(t){var e;this._ticker&&this._ticker.remove(_o,this),this._ticker=t,this._autoUpdate&&(null==(e=this._ticker)||e.add(_o,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;this.destroyed||(t?this._ticker?(this._ticker.add(_o,this),this._autoUpdate=!0):h.warn(this.model.tag,"No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI)."):(null==(e=this._ticker)||e.remove(_o,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(t){t!==this.autoHitTest&&(t?this.model.on("pointertap",Fo,this):this.model.off("pointertap",Fo,this),this._autoHitTest=t)}get autoFocus(){return this._autoFocus}set autoFocus(t){t!==this.autoFocus&&(t?this.model.on("globalpointermove",To,this):this.model.off("globalpointermove",To,this),this._autoFocus=t)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(t){this.autoHitTest=t,this.autoFocus=t}onTickerUpdate(){const t=this.ticker.deltaMS;this.model.update(t)}onTap(t){this.model.tap(t.global.x,t.global.y)}onPointerMove(t){this.model.focus(t.global.x,t.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};i(So,"defaultTicker");let jo=So;function _o(){this.onTickerUpdate()}function Fo(t){this.onTap(t)}function To(t){this.onPointerMove(t)}class Ro extends e.Transform{}const Lo=new e.Point,Do=new e.Matrix;class ko extends r.Container{constructor(t){super(),i(this,"tag","Live2DModel(uninitialized)"),i(this,"internalModel"),i(this,"textures",[]),i(this,"transform",new Ro),i(this,"anchor",new e.ObservablePoint(this.onAnchorChange,this,0,0)),i(this,"glContextID",-1),i(this,"elapsedTime",0),i(this,"deltaTime",0),i(this,"automator"),this.automator=new jo(this,t),this.once("modelLoaded",(()=>this.init(t)))}static from(t,e){const r=new this(e);return Io.setupLive2DModel(r,t,e).then((()=>r))}static fromSync(t,e){const r=new this(e);return Io.setupLive2DModel(r,t,e).then(null==e?void 0:e.onLoad).catch(null==e?void 0:e.onError),r}static registerTicker(t){jo.defaultTicker=t.shared}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,r,{sound:o,volume:n=.5,expression:i,resetExpression:s=!0,crossOrigin:a,onFinish:l,onError:u}={}){return void 0===e?this.internalModel.motionManager.startRandomMotion(t,r,{sound:o,volume:n,expression:i,resetExpression:s,crossOrigin:a,onFinish:l,onError:u}):this.internalModel.motionManager.startMotion(t,e,r,{sound:o,volume:n,expression:i,resetExpression:s,crossOrigin:a,onFinish:l,onError:u})}parallelMotion(t){return s(this,null,(function*(){this.internalModel.extendParallelMotionManager(t.length);const e=t.map(((t,e)=>{var r;return null==(r=this.internalModel.parallelMotionManager[e])?void 0:r.startMotion(t.group,t.index,t.priority)}));let r=[];for(let t of e)r.push(yield t);return r}))}stopMotions(){return this.internalModel.motionManager.stopAllMotions()}speak(t,{volume:e=.5,expression:r,resetExpression:o=!0,crossOrigin:n,onFinish:i,onError:s}={}){return this.internalModel.motionManager.speak(t,{volume:e,expression:r,resetExpression:o,crossOrigin:n,onFinish:i,onError:s})}stopSpeaking(){return this.internalModel.motionManager.stopSpeaking()}expression(t){return this.internalModel.motionManager.expressionManager?void 0===t?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,r=!1){Lo.x=t,Lo.y=e,this.toModelPosition(Lo,Lo,!0);const o=Lo.x/this.internalModel.originalWidth*2-1,n=Lo.y/this.internalModel.originalHeight*2-1,i=Math.atan2(n,o);this.internalModel.focusController.focus(Math.cos(i),-Math.sin(i),r)}tap(t,e){const r=this.hitTest(t,e);r.length&&(h.log(this.tag,"Hit",r),this.emit("hit",r))}hitTest(t,e){return Lo.x=t,Lo.y=e,this.toModelPosition(Lo,Lo),this.internalModel.hitTest(Lo.x,Lo.y)}toModelPosition(t,e=t.clone(),r){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let n=0;n<this.textures.length;n++){const r=this.textures[n];r.valid&&(!e&&r.baseTexture._glTextures[this.glContextID]||(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(r.baseTexture,0)),this.internalModel.bindTexture(n,r.baseTexture._glTextures[this.glContextID].texture),r.baseTexture.touched=t.textureGC.count)}const r=t.framebuffer.viewport;this.internalModel.viewport=[r.x,r.y,r.width,r.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const o=Do.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(o),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),(null==t?void 0:t.texture)&&this.textures.forEach((e=>e.destroy(t.baseTexture))),this.automator.destroy(),this.internalModel.destroy(),super.destroy(t)}}if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const Co=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(t,e){Co.call(this,t,e),e.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class No extends AMotion{constructor(t){super(),i(this,"params",[]),this.setFadeIn(t.fade_in>0?t.fade_in:u.expressionFadingDuration),this.setFadeOut(t.fade_out>0?t.fade_out:u.expressionFadingDuration),Array.isArray(t.params)&&t.params.forEach((t=>{const e=t.calc||"add";if("add"===e){const e=t.def||0;t.val-=e}else if("mult"===e){const e=t.def||1;t.val/=e}this.params.push({calc:e,val:t.val,id:t.id})}))}updateParamExe(t,e,r,o){this.params.forEach((e=>{t.setParamFloat(e.id,e.val*r)}))}}class Uo extends m{constructor(t,e){var r;super(t,e),i(this,"queueManager",new MotionQueueManager),i(this,"definitions"),this.definitions=null!=(r=this.settings.expressions)?r:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex((e=>e.name===t))}getExpressionFile(t){return t.file}createExpression(t,e){return new No(t)}_setExpression(t){return this.queueManager.startMotion(t)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}}class Go extends io{constructor(t,e){super(t,e),i(this,"definitions"),i(this,"groups",{idle:"idle"}),i(this,"motionDataType","arraybuffer"),i(this,"queueManager",new MotionQueueManager),i(this,"lipSyncIds"),i(this,"expressionManager"),this.definitions=this.settings.motions,this.init(e),this.lipSyncIds=["PARAM_MOUTH_OPEN_Y"]}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new Uo(this.settings,t))}isFinished(){return this.queueManager.isFinished()}createMotion(t,e,r){const o=Live2DMotion.loadMotion(t),n=e===this.groups.idle?u.idleMotionFadingDuration:u.motionFadingDuration;return o.setFadeIn(r.fade_in>0?r.fade_in:n),o.setFadeOut(r.fade_out>0?r.fade_out:n),o}getMotionFile(t){return t.file}getMotionName(t){return t.file}getSoundFile(t){return t.sound}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}class Ho extends e.utils.EventEmitter{constructor(t,e){super(),i(this,"tag"),i(this,"manager"),i(this,"settings"),i(this,"state",new eo),i(this,"playing",!1),i(this,"destroyed",!1),this.settings=t,this.tag=`ParallelMotionManager(${t.name})`,this.state.tag=this.tag,this.manager=e}startMotion(t,e){return s(this,arguments,(function*(t,e,r=to.NORMAL){var o;if(!this.state.reserve(t,e,r))return!1;const n=null==(o=this.manager.definitions[t])?void 0:o[e];if(!n)return!1;const i=yield this.manager.loadMotion(t,e);return!!this.state.start(i,t,e,r)&&(h.log(this.tag,"Start motion:",this.getMotionName(n)),this.emit("motionStart",t,e,void 0),this.playing=!0,this._startMotion(i),!0)}))}startRandomMotion(t,e){return s(this,null,(function*(){const r=this.manager.definitions[t];if(null==r?void 0:r.length){const o=[];for(let e=0;e<r.length;e++)null===this.manager.motionGroups[t][e]||this.state.isActive(t,e)||o.push(e);if(o.length){const r=o[Math.floor(Math.random()*o.length)];return this.startMotion(t,r,e)}}return!1}))}stopAllMotions(){this._stopAllMotions(),this.state.reset()}update(t,e){return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.complete()),this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy"),this.stopAllMotions()}}class Wo extends Ho{constructor(t,e){super(t,e),i(this,"queueManager",new MotionQueueManager)}isFinished(){return this.queueManager.isFinished()}getMotionName(t){return t.file}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}class qo{constructor(t){i(this,"leftParam"),i(this,"rightParam"),i(this,"blinkInterval",4e3),i(this,"closingDuration",100),i(this,"closedDuration",50),i(this,"openingDuration",150),i(this,"eyeState",0),i(this,"eyeParamValue",1),i(this,"closedTimer",0),i(this,"nextBlinkTimeLeft",this.blinkInterval),this.coreModel=t,this.leftParam=t.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=t.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(t){this.eyeParamValue=c(t,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(t){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=t,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+p(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+t/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=t,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+t/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const Bo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class $o extends ao{constructor(t,e,r){super(),i(this,"settings"),i(this,"options"),i(this,"coreModel"),i(this,"motionManager"),i(this,"parallelMotionManager"),i(this,"eyeBlink"),i(this,"eyeballXParamIndex"),i(this,"eyeballYParamIndex"),i(this,"angleXParamIndex"),i(this,"angleYParamIndex"),i(this,"angleZParamIndex"),i(this,"bodyAngleXParamIndex"),i(this,"breathParamIndex"),i(this,"textureFlipY",!0),i(this,"lipSync",!0),i(this,"drawDataCount",0),i(this,"disableCulling",!1),i(this,"hasDrawn",!1),this.coreModel=t,this.settings=e,this.options=Object.assign({},{breathDepth:1},r),this.motionManager=new Go(e,r),this.parallelMotionManager=[],this.eyeBlink=new qo(t),this.eyeballXParamIndex=t.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=t.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=t.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=t.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=t.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=t.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=t.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach((({id:t,value:e})=>this.coreModel.setParamFloat(t,e))),this.settings.initOpacities&&this.settings.initOpacities.forEach((({id:t,value:e})=>this.coreModel.setPartsOpacity(t,e))),this.coreModel.saveParam();const t=this.coreModel.getModelContext()._$aS;(null==t?void 0:t.length)&&(this.drawDataCount=t.length);let e=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:t=>e=t,get:()=>!this.disableCulling&&e});const r=this.coreModel.getModelContext().clipManager,o=r.setupClip;r.setupClip=(t,e)=>{o.call(r,t,e),e.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const t={};if(this.settings.layout)for(const[e,r]of Object.entries(this.settings.layout)){let o=e;"center_x"===e?o="centerX":"center_y"===e&&(o="centerY"),t[o]=r}return t}updateWebGLContext(t,e){const r=this.coreModel.drawParamWebGL;r.firstDraw=!0,r.setGL(t),r.glno=e;for(const[i,s]of Object.entries(r))s instanceof WebGLBuffer&&(r[i]=null);const o=this.coreModel.getModelContext().clipManager;o.curFrameNo=e;const n=t.getParameter(t.FRAMEBUFFER_BINDING);o.getMaskRenderTexture(),t.bindFramebuffer(t.FRAMEBUFFER,n)}bindTexture(t,e){this.coreModel.setTexture(t,e)}getHitAreaDefs(){var t;return(null==(t=this.settings.hitAreas)?void 0:t.map((t=>({id:t.id,name:t.name,index:this.coreModel.getDrawDataIndex(t.id)}))))||[]}getDrawableIDs(){const t=this.coreModel.getModelContext(),e=[];for(let r=0;r<this.drawDataCount;r++){const o=t.getDrawData(r);o&&e.push(o.getDrawDataID().id)}return e}getDrawableIndex(t){return this.coreModel.getDrawDataIndex(t)}getDrawableVertices(t){if("string"==typeof t&&-1===(t=this.coreModel.getDrawDataIndex(t)))throw new TypeError("Unable to find drawable ID: "+t);return this.coreModel.getTransformedPoints(t).slice()}hitTest(t,e){return this.hasDrawn||h.warn("Trying to hit-test a Cubism 2 model that has not been rendered yet. The result will always be empty since the draw data is not ready."),super.hitTest(t,e)}update(t,e){var r,o,n,i;super.update(t,e);const s=this.coreModel;this.emit("beforeMotionUpdate");const a=this.motionManager.update(s,e),l=this.parallelMotionManager.map((t=>t.update(s,e))),u=a||l.reduce(((t,e)=>t||e),!1);if(this.emit("afterMotionUpdate"),s.saveParam(),null==(r=this.motionManager.expressionManager)||r.update(s,e),u||null==(o=this.eyeBlink)||o.update(t),this.updateFocus(),this.updateNaturalMovements(t,e),this.lipSync&&this.motionManager.currentAudio){let t=this.motionManager.mouthSync(),e=0;const r=1,o=1.2,n=.7;t>0&&(e=.4),t=Math.pow(t,n),t=c(t*o,e,r);for(let i=0;i<this.motionManager.lipSyncIds.length;++i)this.coreModel.setParamFloat(this.coreModel.getParamIndex(this.motionManager.lipSyncIds[i]),t)}null==(n=this.physics)||n.update(e),null==(i=this.pose)||i.update(t),this.emit("beforeModelUpdate"),s.update(),s.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,30*this.focusController.x),this.coreModel.addToParamFloat(this.angleYParamIndex,30*this.focusController.y),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,10*this.focusController.x)}updateNaturalMovements(t,e){const r=e/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*this.options.breathDepth*Math.sin(r/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*this.options.breathDepth*Math.sin(r/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*this.options.breathDepth*Math.sin(r/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*this.options.breathDepth*Math.sin(r/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(r/3.2345))}draw(t){const e=this.disableCulling;t.getParameter(t.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const r=this.drawingMatrix;Bo[0]=r.a,Bo[1]=r.b,Bo[4]=r.c,Bo[5]=r.d,Bo[12]=r.tx,Bo[13]=r.ty,this.coreModel.setMatrix(Bo),this.coreModel.draw(),this.hasDrawn=!0,this.disableCulling=e}extendParallelMotionManager(t){for(;this.parallelMotionManager.length<t;)this.parallelMotionManager.push(new Wo(this.settings,this.motionManager))}destroy(){super.destroy(),this.coreModel=void 0}}class Xo extends Zr{constructor(t){if(super(t),i(this,"moc"),i(this,"textures"),i(this,"layout"),i(this,"hitAreas"),i(this,"initParams"),i(this,"initOpacities"),i(this,"expressions"),i(this,"motions",{}),!Xo.isValidJSON(t))throw new TypeError("Invalid JSON.");this.moc=t.model,f("string",t,this,"textures","textures"),this.copy(t)}static isValidJSON(t){var e;return!!t&&"string"==typeof t.model&&(null==(e=t.textures)?void 0:e.length)>0&&t.textures.every((t=>"string"==typeof t))}copy(t){d("string",t,this,"name","name"),d("string",t,this,"pose","pose"),d("string",t,this,"physics","physics"),d("object",t,this,"layout","layout"),d("object",t,this,"motions","motions"),f("object",t,this,"hit_areas","hitAreas"),f("object",t,this,"expressions","expressions"),f("object",t,this,"init_params","initParams"),f("object",t,this,"init_opacities","initOpacities")}replaceFiles(t){super.replaceFiles(t);for(const[e,r]of Object.entries(this.motions))for(let o=0;o<r.length;o++)r[o].file=t(r[o].file,`motions.${e}[${o}].file`),void 0!==r[o].sound&&(r[o].sound=t(r[o].sound,`motions.${e}[${o}].sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].file=t(this.expressions[e].file,`expressions[${e}].file`)}}const zo={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},Vo={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class Yo{constructor(t,e){i(this,"physicsHairs",[]),this.coreModel=t,e.physics_hair&&(this.physicsHairs=e.physics_hair.map((t=>{const e=new PhysicsHair;return e.setup(t.setup.length,t.setup.regist,t.setup.mass),t.src.forEach((({id:t,ptype:r,scale:o,weight:n})=>{const i=zo[r];i&&e.addSrcParam(i,t,o,n)})),t.targets.forEach((({id:t,ptype:r,scale:o,weight:n})=>{const i=Vo[r];i&&e.addTargetParam(i,t,o,n)})),e})))}update(t){this.physicsHairs.forEach((e=>e.update(this.coreModel,t)))}}class Ko{constructor(t){i(this,"paramIndex",-1),i(this,"partsIndex",-1),i(this,"link",[]),this.id=t}initIndex(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)}}class Jo{constructor(t,e){i(this,"opacityAnimDuration",500),i(this,"partsGroups",[]),this.coreModel=t,e.parts_visible&&(this.partsGroups=e.parts_visible.map((({group:t})=>t.map((({id:t,link:e})=>{const r=new Ko(t);return e&&(r.link=e.map((t=>new Ko(t)))),r})))),this.init())}init(){this.partsGroups.forEach((t=>{t.forEach((t=>{if(t.initIndex(this.coreModel),t.paramIndex>=0){const e=0!==this.coreModel.getParamFloat(t.paramIndex);this.coreModel.setPartsOpacity(t.partsIndex,e?1:0),this.coreModel.setParamFloat(t.paramIndex,e?1:0),t.link.length>0&&t.link.forEach((t=>t.initIndex(this.coreModel)))}}))}))}normalizePartsOpacityGroup(t,e){const r=this.coreModel,o=.5;let n=1,i=t.findIndex((({paramIndex:t,partsIndex:e})=>e>=0&&0!==r.getParamFloat(t)));if(i>=0){const o=r.getPartsOpacity(t[i].partsIndex);n=c(o+e/this.opacityAnimDuration,0,1)}else i=0,n=1;t.forEach((({partsIndex:t},e)=>{if(t>=0)if(i==e)r.setPartsOpacity(t,n);else{let e,i=r.getPartsOpacity(t);e=n<o?-.5*n/o+1:(1-n)*o/.5;(1-e)*(1-n)>.15&&(e=1-.15/(1-n)),i>e&&(i=e),r.setPartsOpacity(t,i)}}))}copyOpacity(t){const e=this.coreModel;t.forEach((({partsIndex:t,link:r})=>{if(t>=0&&r){const o=e.getPartsOpacity(t);r.forEach((({partsIndex:t})=>{t>=0&&e.setPartsOpacity(t,o)}))}}))}update(t){this.partsGroups.forEach((e=>{this.normalizePartsOpacityGroup(e,t),this.copyOpacity(e)}))}}Io.registerRuntime({version:2,test:t=>t instanceof Xo||Xo.isValidJSON(t),ready:()=>Promise.resolve(),isValidMoc(t){if(t.byteLength<3)return!1;const e=new Int8Array(t,0,3);return"moc"===String.fromCharCode(...e)},createModelSettings:t=>new Xo(t),createCoreModel(t){const e=Live2DModelWebGL.loadModel(t),r=Live2D.getError();if(r)throw r;return e},createInternalModel:(t,e,r)=>new $o(t,e,r),createPose:(t,e)=>new Jo(t,e),createPhysics:(t,e)=>new Yo(t,e)}),t.Cubism2ExpressionManager=Uo,t.Cubism2InternalModel=$o,t.Cubism2ModelSettings=Xo,t.Cubism2MotionManager=Go,t.ExpressionManager=m,t.FileLoader=Ao,t.FocusController=x,t.InternalModel=ao,t.LOGICAL_HEIGHT=2,t.LOGICAL_WIDTH=2,t.Live2DExpression=No,t.Live2DEyeBlink=qo,t.Live2DFactory=Io,t.Live2DLoader=po,t.Live2DModel=ko,t.Live2DPhysics=Yo,t.Live2DPose=Jo,t.Live2DTransform=Ro,t.ModelSettings=Zr,t.MotionManager=io,t.MotionPreloadStrategy=no,t.MotionPriority=to,t.MotionState=eo,t.SoundManager=oo,t.VERSION="v0.5.0-mm-5",t.VOLUME=ro,t.XHRLoader=ho,t.ZipLoader=Eo,t.applyMixins=function(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((r=>{"constructor"!==r&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r))}))}))},t.clamp=c,t.config=u,t.copyArray=f,t.copyProperty=d,t.folderName=y,t.logger=h,t.rand=p,t.remove=g,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
